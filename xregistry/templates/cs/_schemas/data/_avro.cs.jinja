// this file was generated by a tool 
{%- if not uses_avro -%}{%- exit -%}{%- endif -%}
{%- set schema_name = class_name | pascal -%}
{%- set schema = root %}
using System;

{%- macro emitclass(type, type_name) -%}
    {%- if type.type == 'record' or not type.type %}
    public partial class {{ type_name | pascal }}
    {
        public static {{ type_name | pascal }} FromData(object? data, string? contentType)
        {
            if ( data is {{ type_name | pascal }})
            {
                return ({{ type_name | pascal }})data;
            }
            contentType = contentType?.Split(';')[0].Trim().ToLowerInvariant();
            var isJson = contentType != null && (contentType == "application/json" || contentType.EndsWith("+json"));
            if (isJson)
            {
                if (data is JsonElement) 
                {
                    return JsonSerializer.Deserialize<{{ type_name | pascal }}>((JsonElement)data);
                }
                else if (data is string)
                {
                    return JsonSerializer.Deserialize<{{ type_name | pascal }}>((string)data);
                }
            } 
            var stream = data as Stream;
            if (stream == null)
            {
                if (data is BinaryData)
                {
                    stream = ((BinaryData)data).ToStream();
                }
                else if (data is byte[])
                {
                    stream = new MemoryStream((byte[])data);
                }
                else
                {
                    throw new NotSupportedException("Data is not of a supported type for conversion to {{ type_name | pascal }}");  
                }
            }
            var decoder = isJson ? new Avro.IO.JsonDecoder(stream) : new Avro.IO.BinaryDecoder(stream);
            var reader = new Avro.Specific.SpecificDatumReader<{{ type_name | pascal }}>({{ type_name | pascal }}._SCHEMA, {{ type_name | pascal }}._SCHEMA);
            return reader.Read(default({{ type_name | pascal }}), decoder);
        }

        public byte[] ToByteArray() 
        {
            var stream = new MemoryStream();
            var encoder = new Avro.IO.BinaryEncoder(stream);
            var writer = new Avro.Specific.SpecificDatumWriter<{{ type_name | pascal }}>({{ type_name | pascal }}._SCHEMA);
            writer.Write(this, encoder);
            return stream.ToArray();
        }
    }
    {%- endif %}
{%- endmacro %}

using System;
using System.Collections.Generic;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace {{ project_name | pascal }}
{

    {{- emitclass(schema, schema_name) }}
}