{%- import "cloudevents.jinja.include" as cloudEvents -%}
{%- import "amqp.jinja.include" as amqp -%}
{%- import "mqtt.jinja.include" as mqtt -%}
{%- set messagegroups = root.messagegroups %}
{%- set uses_cloudevents_message = (root | exists( "format", "cloudevents" )) %}
{%- set uses_http_endpoint = (root | exists( "protocol", "http" )) %}
{%- set uses_amqp_message = (root | exists( "binding", "amqp" )) %}
{%- set uses_amqp_endpoint = (root | exists( "protocol", "amqp" )) %}
{%- set uses_mqtt_message = (root | exists( "binding", "mqtt" )) %}
{%- set uses_mqtt_endpoint = (root | exists( "protocol", "mqtt" )) %}
// this file was generated by a tool 
package {{ class_name | namespace | lower }};

import io.cloudevents.CloudEvent;
import io.cloudevents.CloudEventData;
import io.cloudevents.core.v1.CloudEventBuilder;
import io.cloudevents.core.format.EventFormat;
import io.cloudevents.core.message.Encoding;

{%- if uses_amqp_message %}
{{ amqp.AmqpImports() }}
{%- endif %}
{%- if uses_mqtt_message %}
{{ mqtt.PahoImports() }}
{%- endif %}
import java.util.ArrayList;

{% for messagegroup_key, messagegroup in messagegroups.items() -%}
{%- set pascalGroupName = messagegroup.id  | pascal -%}
{%- set className = (pascalGroupName | strip_namespace)+"EventFactory" %}
public class {{ className | strip_namespace }}
{
    {% for id in messagegroup.messages -%}
    {%- set definition = messagegroup.messages[id] -%}
    {%- set pascalDefinitionName = definition.id | pascal %}
    {%- set isCloudEvent = not definition.format or definition.format.lower().startswith("cloudevents") -%}
    {%- set isAmqp = not isCloudEvent and definition.format.lower().startswith("amqp") %}
    {%- set isMqtt = not isCloudEvent and definition.format.lower().startswith("mqtt") %}
    public {% if isCloudEvent %}CloudEvent{% elif isAmqp %}Amqp.Message{% elif isMqtt %}MqttMessageV5{% endif %} create{{ pascalDefinitionName | strip_namespace }}(
    {%- if definition.schemaurl -%}
    {%- set toBytes="data.toByteArray()" -%}
    {%- set type = (definition.schemaurl if definition.schemaurl else definition.schema) | schema_type( project_name, root, definition.schemaformat) %}
    {%- set typePackage = type | namespace | lower %}
    {%- set typeName = type | strip_namespace | pascal %}    
    {{ typePackage }}.{{ typeName }} data
    {%- else -%}
    {% set toBytes="data.toBytes()" %}
    CloudEventData data
    {%- endif %}    
    {%- if isCloudEvent -%}
    {{- cloudEvents.DeclareUriTemplateArguments(definition) -}}
    {%- elif isAmqp -%}
    {{- amqp.DeclareUriTemplateArguments(definition) -}}
    {%- elif isMqtt -%}
    {{- mqtt.DeclareUriTemplateArguments(definition) -}}
    {%- endif -%}
    ) throws Exception {
        {% if isCloudEvent %}
        {{- cloudEvents.DeclareCloudNativeCloudEvent("cloudEvent", toBytes, definition) | indent(12)}}
        return cloudEvent;
        {%- elif isAmqp %}
        {{- amqp.DeclareAmqpNetLiteMessage("amqpMessage", definition) | indent(12)}}
        amqpMessage.BodySection = new Data() { Binary = {{ toBytes }} };
        return amqpMessage;
        {%- elif isMqtt %}
        {{- mqtt.DeclareMqttNetMessage("mqttMessage", definition) | indent(12)}}
        return mqttMessage;
        {%- endif %}
    }
    {% endfor %}
}
{% endfor -%}